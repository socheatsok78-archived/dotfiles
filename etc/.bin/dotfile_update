#!/usr/bin/env bash

set -e

cd "$DOTFILE_HOME"

function do_dotfile_clean () {
    git_dirty=$(git clean -dfn)

    if [ -n "$git_dirty" ]; then
        c.warn "Detected a dirty dotifle directory.\ndotfile could not update without removing the following files and folder:"
        echo $git_dirty

        read -p "Do you wish to clean up dotfile directory (y/n)?" choice
        case "$choice" in 
            y|Y|yes|Yes|YES ) 
                git clean -df
                c.success "Successfully clean dotfile directory!"
            ;;
            n|N|no|No|NO ) 
                exit 1 
            ;;
            * )
                main 
            ;;
        esac
    fi
}

function do_dotfile_update () {
    git pull --rebase --stat origin master
}

function main () {
    if do_dotfile_clean; then
        do_dotfile_update
    else
        c.error "Oops! Something went wrong. Failed to update dotfile!"
    fi
}

# Entrypoint
main;
